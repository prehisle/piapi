## **`piapi` 需求变更：支持按服务类型进行路由**

**背景**

当前版本的 `piapi` 路由策略是 **用户级别** 的，即一个用户的所有请求都会被路由到其绑定的唯一一个服务商。这导致我们无法为一个用户同时提供来自不同服务商的服务（例如，`cx` 来自服务商A，`cc` 来自服务商B）。

**核心需求**

我们需要将路由策略从“用户级别”升级为“**用户-服务级别**”。网关的路由决策不应仅取决于“谁在请求”，而应取决于“**谁在请求哪种服务**”。

**具体变更点**

**1. 修改 `config.yaml` 的用户配置结构**

`users` 配置项需要进行如下调整：
*   移除用户对象下的 `providerName` 和 `providerKeyName` 字段。
*   新增一个名为 `services` 的映射（map）。
    *   该映射的 **键 (key)** 是服务类型字符串（如 `"cx"`, `"cc"`）。
    *   该映射的 **值 (value)** 是一个包含 `providerName` 和 `providerKeyName` 的对象，用于定义该服务具体的路由目标。

**配置示例：**

**旧配置 (Before):**
```yaml
users:
  - name: zdy
    apiKey: piapi-user-zdy
    providerName: xychatai
    providerKeyName: main-key
```

**新配置 (After):**
```yaml
users:
  - name: zdy
    apiKey: piapi-user-zdy
    services:
      # 'cx' 服务的路由策略
      cx:
        providerName: xychatai
        providerKeyName: main-key
      # 'cc' 服务的路由策略
      cc:
        providerName: 88code
        providerKeyName: main-key
```

**2. 调整网关的核心路由逻辑**

*   **数据模型更新**: 修改内部 `config` 包中的Go `structs`，以匹配新的YAML结构。
*   **路由解析逻辑变更**:
    1.  当网关收到一个请求时（例如 `.../piapi/cx/...`），首先像现在一样认证用户。
    2.  认证成功后，从请求URL中解析出服务类型（`"cx"`）。
    3.  在用户的 `services` 映射中，使用该服务类型作为键，查找对应的路由策略（即 `providerName` 和 `providerKeyName`）。
    4.  如果找不到对应的服务策略，应返回 `404 Not Found` 或 `403 Forbidden`，表示该用户无权访问此服务。
    5.  使用查找到的 `providerName` 和 `providerKeyName` 继续后续的请求转发流程。

**验收标准 (Acceptance Criteria)**

*   `piapi` 能够成功加载并解析新结构的 `config.yaml` 文件。
*   根据上述新配置，用户 `zdy` 对 `.../piapi/cx` 的请求被正确路由到 `xychatai`。
*   用户 `zdy` 对 `.../piapi/cc` 的请求被正确路由到 `88code`。
*   如果一个用户没有配置对某个服务的访问策略（例如，用户 `zdy` 请求 `.../piapi/some-other-service`），请求应被拒绝。
*   所有现有的测试（单元测试、集成测试）都需要更新以适应新的逻辑，并确保测试通过。